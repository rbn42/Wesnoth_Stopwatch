[modification]
    id=stopwatch
    name=_"Stopwatch"
    description=_"Who is the slowest player?"
    require_modification=no
    [event]
        name=side turn
        first_time_only=yes
        [lua]
            code = <<
                        local result = wesnoth.synchronize_choice(
                            function()
                                local t0 = wesnoth.get_time_stamp()
                                return { value = t0 }
                            end)
                        local t0 = result.value
                        wesnoth.set_variable("Stopwatch_time", t0)
                        >>
        [/lua]
    [/event]
    [event]
        name=side turn end
        first_time_only=no
        [lua]
            code = <<
                        local result = wesnoth.synchronize_choice(
                            function()
                                local t0 = wesnoth.get_time_stamp()
                                return { value = t0 }
                            end)
                        local t0 = result.value
                        local t1 = wesnoth.get_variable("Stopwatch_time")
                        t1 = t0 - t1
                        local k2 = "Stopwatch_side" .. wesnoth.current.side
                        local t2 = wesnoth.get_variable(k2)
                        if t2 == nil then t2 = 0 end
                        t2 = t1 + t2
                        wesnoth.set_variable("Stopwatch_time", t0)
                        wesnoth.set_variable(k2, t2)
                        local name = wesnoth.sides[wesnoth.current.side].name
                        wesnoth.message(name, "finished turn in " .. math.floor(t1/1000) .. "s (" .. math.floor(t2 /1000) .. "s overall).")
			>>
        [/lua]
    [/event]
[/modification]
