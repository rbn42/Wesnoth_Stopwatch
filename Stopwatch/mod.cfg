[modification]
    id=stopwatch
    name=_"Stopwatch"
    description=_"Who is the slowest player?"
    require_modification=no
    [event]
        name=side turn
        first_time_only=no
        [lua]
            code = <<
                        local result = wesnoth.synchronize_choice(
                            function()
                                local t0 = wesnoth.get_time_stamp()
                                return { value = t0 }
                            end)
                        local vname = "Stopwatch_start" .. wesnoth.current.side
                        wesnoth.set_variable(vname, result.value)
                        >>
        [/lua]
    [/event]
    [event]
        name=side turn end
        first_time_only=no
        [lua]
            code = <<
                        local result = wesnoth.synchronize_choice(
                            function()
                                local t0 = wesnoth.get_time_stamp()
                                return { value = t0 }
                            end)
                        local time_end = result.value
                        local vname = "Stopwatch_start" .. wesnoth.current.side
                        local time_start = wesnoth.get_variable(vname)
                        local duration = time_end - time_start
                        vname = "Stopwatch_overall" .. wesnoth.current.side
                        local time_overall = wesnoth.get_variable(vname)
                        if time_overall == nil then time_overall = 0 end
                        time_overall = time_overall + duration
                        wesnoth.set_variable(vname, time_overall)
                        local name = wesnoth.sides[wesnoth.current.side].name
                        local t = duration
                        t = math.floor(t/1000)
                        if t > 180 then
                            t = math.floor( t / 60 ) .. "m" 
                        else
                            t = t .. "s"
                        end
                        duration = t
                        t = time_overall
                        t = math.floor(t/1000)
                        if t > 180 then
                            t = math.floor( t / 60 ) .. "m" 
                        else
                            t = t .. "s"
                        end
                        time_overall = t
                        wesnoth.message(name, "finished turn in " .. duration .. " (" .. time_overall .. " overall).")
			>>
        [/lua]
    [/event]
[/modification]
